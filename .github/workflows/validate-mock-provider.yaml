name: Validate mock-provider

on:
  # Manual trigger
  workflow_dispatch:
  # Cron schedule for every weekday at 4 PM GMT
  schedule:
    - cron: '0 16 * * 1-5'

jobs:
  validate:
    name: Validate mock-provider
    runs-on: ubuntu-latest
    env:
      BASE_URL: ${{ secrets.MOCK_PROVIDER_BASE_URL }}
      CLIENT_API_KEY: ${{ secrets.MOCK_PROVIDER_API_KEY }}
      PROVIDER_ID: ${{ secrets.MOCK_PROVIDER_ID }}
      OPENAPI_SPEC: specification-swagger.yaml
      QUOTE_OUT_MOCK: quoteOutNigeriaCUSD
      FIAT_ACCOUNT_MOCK: accountNumberNigeria
      KYC_MOCK: personalDataAndDocumentsNigeria
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v3
        with:
          node-version: '16'
          check-latest: true
      - uses: actions/cache@v2
        with:
          path: |
            node_modules
            */*/node_modules
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: Get specification swagger
        uses: wei/curl@v1
        with:
          args: -o specification-swagger.yaml https://raw.githubusercontent.com/fiatconnect/specification/main/swagger.yaml
      - run: yarn
      - run: yarn validate
